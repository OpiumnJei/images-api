# =====================================================
# CONFIGURACIÓN PARA RENDER + MYSQL EXTERNO (TiDB Cloud)
# =====================================================
# =====================================================
# JPA / HIBERNATE
# =====================================================
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.open-in-view=false
# TiDB es compatible con MySQL, usar dialecto MySQL 8
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# =====================================================
# LOGGING (Reducido para menor consumo de memoria)
# =====================================================
logging.level.root=WARN
logging.level.com.greetingsapp.imagesapi=INFO
logging.level.org.hibernate.SQL=WARN
logging.level.org.springframework.security=WARN
logging.level.com.zaxxer.hikari=INFO
logging.pattern.console=%d{HH:mm:ss} %-5level %logger{20} - %msg%n

# =====================================================
# HIKARICP - OPTIMIZADO PARA RENDER FREE + TIDB
# =====================================================
# Pool muy pequeño para minimizar conexiones (TiDB maneja bien pocas conexiones)
spring.datasource.hikari.maximum-pool-size=3
spring.datasource.hikari.minimum-idle=1
# Timeout más largo para conexiones externas
spring.datasource.hikari.connection-timeout=30000
# Conexiones idle se cierran más rápido (5 minutos)
spring.datasource.hikari.idle-timeout=300000
# Vida máxima de conexión (15 minutos - TiDB recomienda renovar)
spring.datasource.hikari.max-lifetime=900000
spring.datasource.hikari.leak-detection-threshold=60000
# Nombre del pool para debugging
spring.datasource.hikari.pool-name=RenderHikariPool

# =====================================================
# CONFIGURACIÓN SSL PARA TIDB CLOUD
# =====================================================
# TiDB Cloud requiere SSL - esto se configura en la URL
# Ejemplo URL: jdbc:mysql://gateway.us-east-1.prod.aws.tidbcloud.com:4000/images_app?sslMode=VERIFY_IDENTITY

# =====================================================
# ACTUATOR - HEALTH CHECKS
# =====================================================
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true

# =====================================================
# CORS
# =====================================================
cors.allowed.origins=${CORS_ALLOWED_ORIGINS:*}

# =====================================================
# COMPRESIÓN HTTP
# =====================================================
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/plain
server.compression.min-response-size=1024

# =====================================================
# TIMEOUTS (Ajustados para conexión externa)
# =====================================================
spring.mvc.async.request-timeout=45000
server.tomcat.connection-timeout=30000

# =====================================================
# MEMORIA - OPTIMIZACIÓN PARA 512MB
# =====================================================
# Desactivar cache de segundo nivel de Hibernate (ahorra RAM)
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false
